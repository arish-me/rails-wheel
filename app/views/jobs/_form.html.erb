<div class="space-y-1 mb-6 text-center">
  <h1 class="text-2xl font-medium md:text-2xl">Let's brief your Job</h1>
  <p class="text-secondary text-sm">This will help you to standup in the crowd.</p>
</div>
<div class="grow max-w-5xl w-full mx-auto bg-white flex flex-col justify-center md:py-0 py-6 px-4 md:px-0">
  <%= styled_form_with model: @job, class: "space-y-6" do |f| %>
    <% if @job.errors.any? %>
      <%= render "shared/form_errors", model: @job %>
    <% end %>
      <!-- Basic Information -->
      <section class="space-y-4 mb-4  px-4 py-5  sm:p-6">
        <h3 class="text-lg font-medium text-gray-900">Basic Information</h3>
        <div>
          <%= f.text_field :title, label: 'Job Title', placeholder: 'e.g. Senior Ruby Developer' %>
        </div>
        <div>
        <%= f.rich_textarea :description, label: 'Job Description',
            placeholder: 'Describe the role, responsibilities, and what makes this position exciting...',
            rows: 8 %>
        </div>
      </section>

      <section class="md:col-span-2">

      </section>
      <!-- Job Details -->
      <section class=" space-y-4 mb-4  px-4 py-5  sm:p-6">
        <h3 class="text-lg font-medium text-gray-900">Job Details</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="relative" data-controller="multi-select"
               data-multi-select-max-items-value="5" <%# <-- Pass maxItems as a Stimulus value %>
               data-multi-select-placeholder-value="Select up to 5 specializations" <%# <-- Pass placeholder as a Stimulus value %>
               data-multi-select-remove-item-button-value="true" <%# <-- Pass boolean for remove button %>
               data-multi-select-search-enabled-value="true" <%# <-- Pass boolean for search %>
               >
              <%= f.select :candidate_role_ids,
                            options_from_collection_for_select(
                              @candidate_role_groups.flat_map(&:candidate_roles),
                              :id,
                              :name,
                              selected: @job&.candidate_role_ids
                            ),
                            {},
                            multiple: true,
                            data: { multi_select_target: "select" }

            %>
            </div>

              <div data-controller="multi-select"
               data-multi-select-max-items-value="10"
               data-multi-select-placeholder-value="Select up to 10 skills"
               data-multi-select-remove-item-button-value="true"
               data-multi-select-search-enabled-value="true">
              <%= f.select :skill_ids,
                            options_from_collection_for_select(
                              @skills || [],
                              :id,
                              :name,
                              selected: @job&.skill_ids
                            ),
                            {},
                            multiple: true,
                            data: { multi_select_target: "select" }
            %>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <%= f.select :role_type,
              RoleType::TYPES.map { |type| [type.to_s.titleize, type] },
              { label: 'Job Type' } %>

          <%= f.select :role_level,
              RoleLevel::TYPES.map { |level| [level.to_s.titleize, level] },
              { label: 'Experience Level' } %>

          <%= f.select :remote_policy,
              Job::REMOTE_POLICIES.map { |policy| [policy.titleize, policy] },
              { label: 'Remote Policy' } %>
        </div>
      </section>

        <!-- Salary Information -->
        <section class=" space-y-4 mb-4  px-4 py-5  sm:p-6">
          <h4 class="text-md font-medium text-gray-700">Salary Information</h4>

          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <%= f.number_field :salary_min, label: 'Minimum Salary',
                placeholder: '50000', step: '0.01' %>

            <%= f.number_field :salary_max, label: 'Maximum Salary',
                placeholder: '80000', step: '0.01' %>

            <%= f.select :salary_currency,
                [['USD', 'USD'], ['EUR', 'EUR'], ['GBP', 'GBP'], ['CAD', 'CAD']],
                { label: 'Currency' } %>

            <%= f.select :salary_period,
                Job::SALARY_PERIODS.map { |period| [period.titleize, period] },
                { label: 'Period' } %>
              </div>
          </section>


            <%= f.fields_for :location, include_id: false do |location| %>

      <section class=" space-y-4 mb-4  px-4 py-5  sm:p-6">
        <div class="md:grid md:grid-cols-3 md:gap-6">
          <div class="md:col-span-1">
            <h2 class="text-lg font-medium leading-6 text-gray-900"><%= t("location.title") %></h2>
            <p class="mt-2 text-sm text-gray-500"><%= t("location.help_text") %></p>
          </div>
          <div class="mt-5 md:mt-0 md:col-span-2">
            <div class="space-y-6">
              <div class="form-field pr-0 combobox">
                <%= location.combobox :location_search, locations_city_suggestions_path, id: "location-search-combobox", label: 'Select Location', placeholder: 'Enter location e.g. San Francisco, California' %>
              </div>
              <%if Rails.env.development? && false  %>
                <%= location.text_field :location_search, placeholder: 'Enter address e.g. San Francisco, California' %>
                <div class="form-field combobox text-xs">
                  <%= location.combobox :country,  ISO3166::Country.pluck(:iso_short_name) %>
                </div>
              <% end %>
              <%if Rails.env.development? && false  %>
                <div data-controller="places-autocomplete">
                  <div class="mb-4">
                    <%= location.text_field :location_search %>
                    <%= form.combobox :country_code,  ISO3166::Country.pluck(:iso_short_name) %>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search Address</label>
                    <%= location.combobox :location_search,
                  label: 'Search Address',
                  placeholder: 'Start typing your city...',
                  data: {
                    action: "keydown->places-autocomplete#preventSubmit",
                    places_autocomplete_target: "address"
                  }
                %>
                    <p class="mt-1 text-xs text-gray-500">Please enter a complete address including city, state, and country</p>
                  </div>
                  <!-- Hidden fields that will be populated by autocomplete -->
                  <%= location.hidden_field :city, data: { places_autocomplete_target: "city" } %>
                  <%= location.hidden_field :state, data: { places_autocomplete_target: "state" } %>
                  <%= location.hidden_field :country, data: { places_autocomplete_target: "country" } %>
                  <!-- Additional hidden fields for autocomplete -->
                  <input type="hidden" data-places-autocomplete-target="streetNumber" />
                  <input type="hidden" data-places-autocomplete-target="route" />
                  <input type="hidden" data-places-autocomplete-target="county" />
                  <input type="hidden" data-places-autocomplete-target="postalCode" />
                  <input type="hidden" data-places-autocomplete-target="longitude" />
                  <input type="hidden" data-places-autocomplete-target="latitude" />
                  <!-- Display selected location details -->
                  <%if Rails.env.development? && false  %>
                    <div id="location-display" class="hidden mt-4 p-3 bg-gray-50 rounded-md">
                      <h4 class="text-sm font-medium text-gray-900 mb-2">Selected Location:</h4>
                      <div class="text-sm text-gray-600">
                        <div id="city-display"></div>
                        <div id="state-display"></div>
                        <div id="country-display"></div>
                      </div>
                    </div>
                  <% end  %>
                </div>
              <% end  %>
            </div>
          </div>
        </div>
      </section>


    <% end %>

      <!-- Application Settings -->
      <section class=" space-y-4 mb-4  px-4 py-5  sm:p-6">
        <h3 class="text-lg font-medium text-gray-900">Application Settings</h3>

        <div class="space-y-4">
          <div class="flex items-center">
            <%= f.check_box :allow_cover_letter, class: "focus:ring-gray-500 h-4 w-4 border-gray-300 rounded" %>
            <%= f.label :allow_cover_letter, class: "ml-3 block text-sm font-medium" %>
          </div>
          <div class="flex items-center">
            <%= f.check_box :require_portfolio, class: "focus:ring-gray-500 h-4 w-4 border-gray-300 rounded" %>
            <%= f.label :require_portfolio, class: "ml-3 block text-sm font-medium" %>
          </div>
          <%= f.rich_textarea :application_instructions, label: 'Application Instructions',
              placeholder: 'Any specific instructions for applicants...',
              rows: 3, class: 'block w-full sm:text-sm border rounded-md'  %>
        </div>
      </section>

      <!-- Publishing -->
      <section class=" space-y-4 mb-4  px-4 py-5  sm:p-6">
        <h3 class="text-lg font-medium text-gray-900">Publishing</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <%= f.select :status,
              Job::STATUSES.map { |status| [status.titleize, status] },
              { label: 'Status' } %>

          <%= f.datetime_field :expires_at, label: 'Expires At' %>
        </div>


        <div class="flex items-center">
            <%= f.check_box :featured, class: "focus:ring-gray-500 h-4 w-4 border-gray-300 rounded" %>
            <%= f.label :featured, class: "ml-3 block text-sm font-medium" %>
        </div>
      </section>

      <!-- External Integration -->
      <section class=" space-y-4 mb-4  px-4 py-5  sm:p-6">
        <h3 class="text-lg font-medium text-gray-900">External Integration (Optional)</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <%= f.text_field :external_id, label: 'External ID',
              placeholder: 'For external job board integration' %>

          <%= f.select :external_source,
              [['LinkedIn', 'linkedin'], ['Indeed', 'indeed'], ['Glassdoor', 'glassdoor']],
              { include_blank: 'Select source', label: 'External Source' } %>
        </div>
      </section>

      <!-- Submit -->

      <section class="flex justify-between space-x-3 pt-6 border-t border-gray-200 p-3">
        <%= link_to 'Cancel', jobs_path,
            class: "px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" %>

        <%= f.submit @job.new_record? ? 'Create Job' : 'Update Job', data: { full_width: false } %>
      </section>
    </div>
  <% end %>
</div>
