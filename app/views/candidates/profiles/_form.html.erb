<%= styled_form_with model: @candidate, url: candidate_profile_path(@candidate, @candidate.profile), method: :patch, local: true, class: "space-y-8" do |form| %>
  
  <!-- Upload Section -->
  <%= form.fields_for :user do |user_form| %>
    <div>
      <div data-controller="file-upload" data-file-upload-visibility-class="hidden" data-file-upload-loading-class="opacity-50">
        <div class="relative">
          <%= user_form.hidden_field :cover_image, value: user_form.object.cover_image.signed_id, id: "developer_cover_image_hidden" if user_form.object.cover_image.attached? %>
          <%= user_form.file_field :cover_image, direct_upload: true, accept: "image/png, image/jpg, image/jpeg, image/gif", data: {action: "input->file-upload#select direct-upload:initialize->file-upload#start direct-upload:error->file-upload#error"}, class: "hidden" %>
          <%= user_form.label :cover_image, t("profile.change"), class: "cursor-pointer absolute right-0 z-10 m-5 bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm leading-4 font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" %>
          <%= render Candidates::CoverImageComponent.new(developer: current_user, data: {"file-upload-target": "image"}, classes: "rounded-md mb-4") %>
          <div data-file-upload-target="activity" class="hidden absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2">
            <%= inline_svg_tag "icons/outline/refresh.svg", class: "w-8 h-8 text-gray-900 animate-reverse-spin", title: t("common.loading") %>
          </div>
        </div>
        <div data-file-upload-target="error" class="hidden bg-red-50 border-l-4 border-red-400 p-4 mt-4">
          <div class="ml-3">
            <p class="text-sm text-red-700"><%= t("profile.upload_error_text") %></p>
          </div>
        </div>
      </div>
      <div class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 mt-2">
        <div class="-mt-12 sm:-mt-16 sm:flex sm:items-end sm:space-x-5">
          <div data-controller="file-upload" data-file-upload-visibility-class="hidden" data-file-upload-loading-class="opacity-50">
            <div class="relative">
              <%= render AvatarComponent.new(avatarable: current_user, variant: :thumbnail, data: {"file-upload-target": "image"}) %>
              <div data-file-upload-target="activity" class="hidden absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2">
                <%= inline_svg_tag "icons/outline/refresh.svg", class: "w-8 h-8 text-gray-900 animate-reverse-spin", title: t("common.loading") %>
              </div>
              <%= user_form.hidden_field :profile_image, value: user_form.object.profile_image.signed_id, id: "developer_avatar_hidden" if user_form.object.profile_image.attached? %>
              <%= user_form.file_field :profile_image, direct_upload: true, accept: "image/png, image/jpg, image/jpeg", data: {action: "file-upload#select direct-upload:initialize->file-upload#start direct-upload:error->file-upload#error"}, class: "hidden" %>
              <%= user_form.label :profile_image, t("profile.change"), class: "flex justify-center cursor-pointer mt-2 bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm leading-4 font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500" %>
              <div data-file-upload-target="error" class="hidden bg-red-50 border-l-4 border-red-400 p-4 mt-2">
                <div class="ml-3">
                  <p class="text-sm text-red-700"><%= t("profile.avatar_error_text") %></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Personal Details Section -->
  <%= form.fields_for :user do |user_form| %>
    <section class="bg-white shadow px-4 py-5 lg:rounded-lg sm:p-6">
      <div class="md:grid md:grid-cols-3 md:gap-6">
        <div class="md:col-span-1">
          <h2 class="text-lg font-medium leading-6 text-gray-900"><%= t("profile.title") %></h2>
          <p class="mt-2 text-sm text-gray-500"><%= t("profile.help_text") %></p>
        </div>
        <div class="mt-5 md:mt-0 md:col-span-2">
          <div class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <%= user_form.text_field :first_name, label: 'First Name' , placeholder: 'Enter First Name' %>
              </div>
              <div>
                <%= user_form.text_field :last_name, label: 'Last Name' , placeholder: 'Enter Last Name' %>
              </div>
              <div>
                <%= user_form.select :gender,  User.genders.map { |key, _| [User::GENDER_DISPLAY[key.to_sym], key] }, { include_blank: "---Select---", label: "Pronounce" } %>
              </div>
              <div>
                <%= user_form.telephone_field :phone_number, placeholder: "+1 (555) 123-4567" , label: "Phone" %>
              </div>
              <div>
                <%= user_form.date_field :date_of_birth,   max: Date.today - 10.years, min: Date.today - 120.years, label: "Date of birth" %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  <% end %>

  <!-- Professional Information Section -->
  <%= form.fields_for :profile do |profile_form| %>
    <section class="bg-white shadow px-4 py-5 lg:rounded-lg sm:p-6">
      <div class="md:grid md:grid-cols-3 md:gap-6">
        <div class="md:col-span-1">
          <h2 class="text-lg font-medium leading-6 text-gray-900">Professional Information</h2>
          <p class="mt-2 text-sm text-gray-500">Update your professional details and role information.</p>
        </div>
        <div class="mt-5 md:mt-0 md:col-span-2">
          <div class="space-y-6">
            <div class="grid grid-cols-1 gap-6">
              <div>
                <%= profile_form.text_field :headline, label: 'Title / Headline' , placeholder: 'Enter Title or Headline' %>
                <p class="mt-2 text-xs text-gray-500">e.g. Full-stack developer with 6+ years of experience</p>
              </div>
              <div>
                <%= profile_form.collection_select :candidate_role_id, CandidateRole.all.order(:name), :id, :name, { prompt: "--Select--", label: "Candidate Role" } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  <% end %>

  <!-- Social Links Section -->
  <%= form.fields_for :social_link do |social_link_form| %>
    <section class="bg-white shadow px-4 py-5 lg:rounded-lg sm:p-6">
      <div class="md:grid md:grid-cols-3 md:gap-6">
        <div class="md:col-span-1">
          <h2 class="text-lg font-medium leading-6 text-gray-900"><%= t("online_presence.title") %></h2>
          <p class="mt-2 text-sm text-gray-500"><%= t("online_presence.help_text") %></p>
        </div>
        <div class="mt-5 md:mt-0 md:col-span-2">
          <div class="space-y-6">
            <div>
              <div class="mt-1 flex rounded-md shadow-sm">
                <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                  https://
                </span>
                <%= social_link_form.text_field :website, label: 'Enter Website' , placeholder: 'yourexample.com' %>
              </div>
            </div>
            <div>
              <div class="mt-1 flex rounded-md shadow-sm">
                <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                  https://
                </span>
                <%= social_link_form.text_field :github, label: 'Enter Github Profile Link' , placeholder: 'github.com/username' %>
              </div>
            </div>
            <div>
              <div class="mt-1 flex rounded-md shadow-sm">
                <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                  https://
                </span>
                <%= social_link_form.text_field :linked_in, label: 'Enter LinkedIn Profile Link' , placeholder: 'linkedin.com/in/username' %>
              </div>
            </div>
            <div>
              <div class="mt-1 flex rounded-md shadow-sm">
                <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                  https://
                </span>
                <%= social_link_form.text_field :twitter, label: 'Enter Twitter Profile Link' , placeholder: 'twitter.com/username' %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  <% end %>

  <!-- Navigation -->
  <div class="flex justify-between mt-6">
    <div></div>
    <div class="flex space-x-3">
      <%= render ButtonComponent.new(text: "Save", type: "submit", class: "md:w-auto w-full justify-center") %>
      <%= link_to "Next: Work Preferences", edit_candidate_work_preference_path(@candidate), class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
    </div>
  </div>

<% end %>