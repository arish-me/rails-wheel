<%= styled_form_with model: @profile, url: candidate_profile_path(@candidate), method: :patch, local: true, class: "space-y-8" do |form| %>
	<!-- Professional Information Section -->
		<section class="bg-white shadow px-4 py-5 lg:rounded-lg sm:p-6">
			<div class="md:grid md:grid-cols-3 md:gap-6">
				<div class="md:col-span-1">
					<h2 class="text-lg font-medium leading-6 text-gray-900">Professional Information</h2>
					<p class="mt-2 text-sm text-gray-500">Update your professional details and role information.</p>
				</div>
				<div class="mt-5 md:mt-0 md:col-span-2">
					<div class="space-y-6">
						<div class="grid grid-cols-1 gap-6">
							<div>
								<%= form.text_field :headline, label: 'Title / Headline' , placeholder: 'Enter Title or Headline' %>
								<p class="mt-2 text-xs text-gray-500">e.g. Full-stack developer with 6+ years of experience</p>
							</div>
							<div>
								<%= form.collection_select :candidate_role_id, CandidateRole.all.order(:name), :id, :name, { prompt: "--Select--", label: "Candidate Role" } %>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

	<!-- Personal Details Section -->
	<%= form.fields_for :user do |user_form| %>
		<section class="bg-white shadow px-4 py-5 lg:rounded-lg sm:p-6">
			<div class="md:grid md:grid-cols-3 md:gap-6">
				<div class="md:col-span-1">
					<h2 class="text-lg font-medium leading-6 text-gray-900"><%= t("profile.title") %></h2>
					<p class="mt-2 text-sm text-gray-500"><%= t("profile.help_text") %></p>
				</div>
				<div class="mt-5 md:mt-0 md:col-span-2">
					<div class="space-y-6">
						<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
							<div>
								<%= user_form.text_field :first_name, label: 'First Name' , placeholder: 'Enter First Name' %>
							</div>
							<div>
								<%= user_form.text_field :last_name, label: 'Last Name' , placeholder: 'Enter Last Name' %>
							</div>
							<div>
								<%= user_form.select :gender,  User.genders.map { |key, _| [User::GENDER_DISPLAY[key.to_sym], key] }, { include_blank: "---Select---", label: "Pronounce" } %>
							</div>
							<div>
								<%= user_form.telephone_field :phone_number, placeholder: "+1 (555) 123-4567" , label: "Phone" %>
							</div>
							<div>
								<%= user_form.date_field :date_of_birth,   max: Date.today - 10.years, min: Date.today - 120.years, label: "Date of birth" %>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	<% end %>

	<!-- Location Section with Places Autocomplete -->
	<%= form.fields_for :location, include_id: false do |location| %>
	<section class="bg-white shadow px-4 py-5 lg:rounded-lg sm:p-6">
		<div class="md:grid md:grid-cols-3 md:gap-6">
			<div class="md:col-span-1">
				<h2 class="text-lg font-medium leading-6 text-gray-900"><%= t("location.title") %></h2>
				<p class="mt-2 text-sm text-gray-500"><%= t("location.help_text") %></p>
			</div>
			<div class="mt-5 md:mt-0 md:col-span-2">
				<div class="space-y-6">
					<div
						data-controller="places-autocomplete"
						data-action="google-maps-callback@window->places-autocomplete#initAutocomplete"
					>
						<div class="mb-4">
							<label class="block text-sm font-medium text-gray-700 mb-2">Search Address</label>
							<input
								type="text"
								data-action="keydown->places-autocomplete#preventSubmit"
								data-places-autocomplete-target="address"
								placeholder="Start typing your address..."
								class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
							/>
							<p class="mt-1 text-xs text-gray-500">Please enter a complete address including city, state, and country</p>
						</div>

						<!-- Hidden fields that will be populated by autocomplete -->
						<%= location.hidden_field :city, data: { places_autocomplete_target: "city" } %>
						<%= location.hidden_field :state, data: { places_autocomplete_target: "state" } %>
						<%= location.hidden_field :country_code, data: { places_autocomplete_target: "country" } %>

						<!-- Additional hidden fields for autocomplete -->
						<input type="hidden" data-places-autocomplete-target="streetNumber" />
						<input type="hidden" data-places-autocomplete-target="route" />
						<input type="hidden" data-places-autocomplete-target="county" />
						<input type="hidden" data-places-autocomplete-target="postalCode" />
						<input type="hidden" data-places-autocomplete-target="longitude" />
						<input type="hidden" data-places-autocomplete-target="latitude" />

						<!-- Display selected location details -->
						<%if Rails.env.development? %>
						<div id="location-display" class="hidden mt-4 p-3 bg-gray-50 rounded-md">
							<h4 class="text-sm font-medium text-gray-900 mb-2">Selected Location:</h4>
							<div class="text-sm text-gray-600">
								<div id="city-display"></div>
								<div id="state-display"></div>
								<div id="country-display"></div>
							</div>
						</div>
						<% end  %>
					</div>
				</div>
			</div>
		</div>
	</section>
	<% end %>

	<!-- Navigation -->
	<div class="flex justify-between mt-6">
		<div></div>
		<div class="flex space-x-3">
			<%= render ButtonComponent.new(text: "Save", type: "submit", class: "md:w-auto w-full justify-center") %>
			<%= link_to "Next: Work Preferences", candidate_work_preference_path(@candidate), class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
		</div>
	</div>
<% end %>