<% nav_items = [
  { name: "Dashboard", path: root_path, icon: "pie-chart", icon_custom: false, active: page_active?(root_path), condition: true, mobile_only: true },
  { name: "Jobs", path: jobs_path, icon: "briefcase", icon_custom: false, active: page_active?(jobs_path), condition: can?(:index, Job), mobile_only: true },
  { name: "Browse Jobs", path: public_jobs_path, icon: "search", icon_custom: false, active: page_active?(public_jobs_path), condition: true, mobile_only: true },
  { name: "Job Board Integrations", path: job_board_integrations_path, icon: "link", icon_custom: false, active: page_active?(job_board_integrations_path), condition: current_user.company_user?, mobile_only: true },
  { name: "Management", path: admin_users_path, icon: "users", icon_custom: false, active: page_active?(admin_users_path), condition: can?(:index, User), mobile_only: true },
  { name: "Categories", path: categories_path, icon: "folder", icon_custom: false, active: page_active?(categories_path), condition: can?(:index, Category), mobile_only: true },
  { name: "Management", path: platform_users_path, icon: "folder", icon_custom: false, active: page_active?(categories_path), condition: can?(:index, User, policy_class: Platform::UserPolicy), mobile_only: true },
] %>

  <% plaform_admin_navs = [
  { name: "Dashboard", path: root_path, icon: "pie-chart", icon_custom: false, active: page_active?(root_path), condition: true, mobile_only: true },
  { name: "Management", path: platform_users_path, icon: "pie-chart", icon_custom: false, active: page_active?(root_path), condition: true, mobile_only: true },
]
%>
<% candidate_nav_items = [
   if current_user.user?
    { name: "Profile", path: candidate_path(current_user.candidate), icon: "user", icon_custom: false, active: page_active?(edit_candidate_path(current_user.candidate)), condition: true, mobile_only: true }
  end
  ]
%>
  <% mobile_nav_items = nav_items.select { |item| item[:mobile_only] && item[:condition] } %>
  <% desktop_nav_items = nav_items.select { |item| item[:condition] } %>
  <% expanded_sidebar_class = "w-full" %>
  <% collapsed_sidebar_class = "w-0" %>

  <%= render "layouts/shared/htmldoc" do %>
    <meta name="user-signed-in" content="true">
    <meta name="direct-upload-url" content="<%= rails_direct_uploads_path %>">
    <div
    class="flex flex-col lg:flex-row h-full bg-surface"
    data-controller="app-layout"
    data-app-layout-expanded-sidebar-class="<%= expanded_sidebar_class %>"
    data-app-layout-collapsed-sidebar-class="<%= collapsed_sidebar_class %>"
    data-app-layout-user-id-value="<%= current_user.id %>">
      <%# MOBILE - Top nav %>
      <nav class="lg:hidden flex justify-between items-center p-3">
        <%= icon("panel-left", as_button: true, data: { action: "app-layout#openMobileSidebar"}) %>
        <%= link_to root_path, class: "block" do %>
        <% end %>
        <%= render "users/user_menu", user: current_user, placement: "bottom-end", offset: 12 %>
      </nav>
      <%# DESKTOP - Left navbar %>
      <div class="hidden lg:block">
        <nav class="h-full flex flex-col shrink-0 w-[84px] py-4 mr-3">
          <div class="pl-2 mb-3">
            <%= render "settings/user_avatar", avatar_url: current_user.company.avatar.variant(:small) %>
          </div>
          <ul class="space-y-0.5">
            <% desktop_nav_items.each do |nav_item| %>
              <li>
                <%= render "layouts/shared/nav_item", **nav_item %>
              </li>
            <% end %>
          </ul>
          <div class="pl-2 mt-auto mx-auto flex flex-col gap-2">
            <%= render ButtonComponent.new(
            variant: "icon",
            icon: "message-circle-question",
            data: { action: "intercom#show" }
          ) %>
            <%= render NotificationComponent.new(current_user: current_user) %>
            <%= render "users/user_menu", user: current_user %>
          </div>
        </nav>
      </div>
      <%# SHARED - Main content %>
      <%= tag.main class: class_names("grow overflow-y-auto px-3 lg:px-10 py-4 w-full mx-auto"), data: { app_layout_target: "content" } do %>
        <div class="hidden lg:flex gap-2 items-center justify-between mb-6">
          <%if impersonating? %>
            <%= render partial: "shared/impersonation_session" %>
          <% end %>
          <div class="flex items-center gap-2">
            <%= turbo_stream_from current_user, "notifications" %>
            <%= icon("panel-left", as_button: true, data: { action: "app-layout#toggleLeftSidebar" }) %>
            <% if content_for?(:breadcrumbs) %>
              <%= yield :breadcrumbs %>
            <% else %>
              <%= render "layouts/shared/breadcrumbs", breadcrumbs: @breadcrumbs %>
            <% end %>
          </div>
          <%= render partial: 'layouts/navs/theme_selector' %>
        </div>
        <% if content_for?(:page_header) %>
          <%= yield :page_header %>
        <% end %>
        <% if content_for?(:user_management_tab) %>
          <%= yield :user_management_tab %>
        <% end %>
        <% if content_for?(:candidate_tab) %>
          <div class="max-w-5xl mx-auto mt-0 pb-8 mb-16 bg-white shadow lg:rounded-lg overflow-hidden">
            <%= yield :candidate_tab %>
          </div>
        <% end %>
        <%= yield %>
      <% end %>
      <%# MOBILE - Bottom Nav %>
      <%= tag.nav class: "lg:hidden bg-surface shrink-0 z-10 pb-[env(safe-area-inset-bottom)] border-t border-tertiary flex justify-around" do %>
        <% mobile_nav_items.each do |nav_item| %>
          <%= render "layouts/shared/nav_item", **nav_item %>
        <% end %>
      <% end %>
    </div>
  <% end %>