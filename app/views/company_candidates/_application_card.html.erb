<div class="w-full">
  <div class="flex items-start justify-between">
    <!-- Left Side - Candidate Information -->
    <div class="flex-1 min-w-0">
      <!-- Candidate Name -->
      <h4 class="text-lg font-medium text-gray-900 mb-3">
        <%= link_to job_application.candidate.user.display_name, company_candidate_path(job_application), class: "hover:text-blue-600" %>
      </h4>
      
      <!-- Location -->
      <div class="flex items-center text-sm text-gray-600 mb-2">
        <%= lucide_icon('map-pin', class: 'w-4 h-4 mr-2 text-gray-400') %>
        <% if job_application.candidate.location.present? %>
          <%= [job_application.candidate.location.city, job_application.candidate.location.state, job_application.candidate.location.country].compact.join(', ') %>
        <% else %>
          <span class="text-blue-600 font-medium">Remote</span>
        <% end %>
      </div>
      
      <!-- Email -->
      <div class="flex items-center text-sm text-gray-600 mb-2">
        <%= lucide_icon('mail', class: 'w-4 h-4 mr-2 text-gray-400') %>
        <%= job_application.candidate.user.email %>
      </div>
      
      <!-- Notes Count -->
      <div class="flex items-center text-sm text-gray-600 mb-2">
        <%= lucide_icon('message-square', class: 'w-4 h-4 mr-2 text-gray-400') %>
        <% notes_count = job_application.status_notes.present? ? 1 : 0 %>
        <span>Notes (<%= notes_count %>)</span>
      </div>
      
      <!-- Applied Jobs Count -->
      <div class="flex items-center text-sm text-gray-600 mb-2">
        <%= lucide_icon('briefcase', class: 'w-4 h-4 mr-2 text-gray-400') %>
        <% applied_jobs_count = job_application.candidate.job_applications.joins(:job).where(jobs: { company: current_user.company }).count %>
        <span>Applied Jobs (<%= applied_jobs_count %>)</span>
      </div>
      
      <!-- Role Level -->
      <% if job_application.candidate.role_level.present? %>
        <div class="flex items-center text-sm text-gray-600 mb-2">
          <%= lucide_icon('trending-up', class: 'w-4 h-4 mr-2 text-gray-400') %>
          <% role_levels = [] %>
          <% role_levels << 'Junior' if job_application.candidate.role_level.junior? %>
          <% role_levels << 'Mid' if job_application.candidate.role_level.mid? %>
          <% role_levels << 'Senior' if job_application.candidate.role_level.senior? %>
          <% role_levels << 'Principal' if job_application.candidate.role_level.principal? %>
          <% role_levels << 'C-Level' if job_application.candidate.role_level.c_level? %>
          <span><%= role_levels.join(', ') %></span>
        </div>
      <% end %>
      
      <!-- Role Type -->
      <% if job_application.candidate.role_type.present? %>
        <div class="flex items-center text-sm text-gray-600">
          <%= lucide_icon('clock', class: 'w-4 h-4 mr-2 text-gray-400') %>
          <% role_types = [] %>
          <% role_types << 'Part Time Contract' if job_application.candidate.role_type.part_time_contract? %>
          <% role_types << 'Full Time Contract' if job_application.candidate.role_type.full_time_contract? %>
          <% role_types << 'Full Time Employment' if job_application.candidate.role_type.full_time_employment? %>
          <span><%= role_types.join(', ') %></span>
        </div>
      <% end %>
    </div>

    <!-- Right Side - Actions and Info -->
    <div class="flex items-start space-x-3 ml-4">
      <!-- Resume Download -->
      <% if job_application.resume.attached? %>
        <%= link_to rails_blob_path(job_application.resume, disposition: 'attachment'),
            class: "inline-flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
            title: "Download Resume" do %>
          <%= lucide_icon('download', class: 'w-4 h-4') %>
        <% end %>
      <% end %>
      
      <!-- Updated At -->
      <div class="text-xs text-gray-500 text-right">
        <div>Updated</div>
        <div><%= time_ago_in_words(job_application.updated_at) %> ago</div>
      </div>
      
      <!-- Actions Dropdown -->
      <div class="relative" data-controller="dropdown">
        <button type="button" 
                class="p-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full"
                data-action="click->dropdown#toggle">
          <%= lucide_icon('more-horizontal', class: 'h-5 w-5') %>
        </button>
        <div data-dropdown-target="menu" 
             class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-10">
          <div class="py-1">
            <%= link_to "View Application", company_candidate_path(job_application), 
                class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
            <button type="button" 
                    class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    data-action="click->candidate-actions#addNote"
                    data-application-id="<%= job_application.id %>">
              Add Note
            </button>
            <button type="button" 
                    class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    data-action="click->candidate-actions#updateStatus"
                    data-application-id="<%= job_application.id %>">
              Update Status
            </button>
            <button type="button" 
                    class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    data-action="click->candidate-actions#viewProfile"
                    data-application-id="<%= job_application.id %>">
              View Profile
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Application Status and Job Info (Below) -->
  <div class="mt-4 pt-4 border-t border-gray-200">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <!-- Status Badge -->
        <%= render 'status_badge', status: job_application.status %>
        
        <!-- Job Title -->
        <span class="text-sm text-gray-600">
          Applied for: <strong><%= job_application.job.title %></strong>
        </span>
        
        <!-- Quick Apply Badge -->
        <% if job_application.is_quick_apply %>
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
            Quick Apply
          </span>
        <% end %>
      </div>
      
      <!-- Applied Date -->
      <span class="text-xs text-gray-500">
        Applied <%= time_ago_in_words(job_application.applied_at) %> ago
      </span>
    </div>
  </div>
</div>
