<% unless user_signed_in? %>
  <%= render 'shared/header' %>
<% end %>

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
  <!-- Enhanced Hero Section -->
  <div class="relative overflow-hidden bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-700">
    <!-- Background Pattern -->
    <div class="absolute inset-0 bg-black/10"></div>
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.05"%3E%3Ccircle cx="30" cy="30" r="2"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>

    <div class="relative mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-20">
      <div class="text-center max-w-4xl mx-auto">
        <h1 class="text-4xl lg:text-6xl font-bold text-white mb-6 leading-tight">
          Find Your Dream Job
          <span class="block text-blue-200 text-3xl lg:text-4xl font-medium mt-2">in Tech & Innovation</span>
        </h1>
        <p class="text-xl text-blue-100 mb-8 max-w-2xl mx-auto">
          Discover thousands of opportunities from top companies. Your next career move starts here.
        </p>

        <!-- Enhanced Search Bar -->
        <%= form_with url: public_jobs_path, method: :get, class: "max-w-3xl mx-auto" do |f| %>
          <div class="flex flex-col sm:flex-row gap-3 bg-white/10 backdrop-blur-sm rounded-2xl p-2 shadow-2xl">
            <div class="flex-1 relative">
              <%= f.text_field :search,
                  value: @filters[:search],
                  placeholder: "Search jobs, companies, or keywords...",
                  class: "w-full px-6 py-4 text-gray-900 placeholder-gray-500 bg-white rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg shadow-sm" %>
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <%= lucide_icon('search', class: 'h-5 w-5 text-gray-400') %>
              </div>
            </div>
            <%= f.submit "Search Jobs",
                class: "px-8 py-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold rounded-xl hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 shadow-lg" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Enhanced Filters Sidebar -->
      <div class="lg:w-1/3 xl:w-1/4">
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 sticky top-6">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-gray-900">Filters</h3>
            <%= link_to "Clear All", public_jobs_path, class: "text-sm text-blue-600 hover:text-blue-700 font-medium" %>
          </div>

          <%= form_with url: public_jobs_path, method: :get, local: true, class: "space-y-6" do |f| %>
            <!-- Hidden search field to preserve search -->
            <%= f.hidden_field :search, value: @filters[:search] if @filters[:search].present? %>

            <!-- Job Type -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Job Type</label>
              <%= f.select :role_type,
                  options_for_select([['All Types', '']] + RoleType::TYPES.map { |type| [type.to_s.titleize, type] }, @filters[:role_type]),
                  {},
                  { class: "block w-full border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-gray-50" } %>
            </div>

            <!-- Experience Level -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Experience Level</label>
              <%= f.select :role_level,
                  options_for_select([['All Levels', '']] + RoleLevel::TYPES.map { |level| [level.to_s.titleize, level] }, @filters[:role_level]),
                  {},
                  { class: "block w-full border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-gray-50" } %>
            </div>

            <!-- Remote Policy -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Remote Policy</label>
              <%= f.select :remote_policy,
                  options_for_select([['All Policies', '']] + Job::REMOTE_POLICIES.map { |policy| [policy.titleize, policy] }, @filters[:remote_policy]),
                  {},
                  { class: "block w-full border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-gray-50" } %>
            </div>

            <!-- Location -->
            <% if @locations.any? %>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Location</label>
                <%= f.select :location,
                    options_for_select([['All Locations', '']] + @locations, @filters[:location]),
                    {},
                    { class: "block w-full border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-gray-50" } %>
              </div>
            <% end %>

            <!-- Company -->
            <% if @companies.any? %>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Company</label>
                <%= f.select :company_id,
                    options_for_select([['All Companies', '']] + @companies.map { |company| [company.name, company.id] }, @filters[:company_id]),
                    {},
                    { class: "block w-full border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-gray-50" } %>
              </div>
            <% end %>

            <!-- Featured Jobs -->
            <div class="flex items-center p-3 bg-blue-50 rounded-lg">
              <%= f.check_box :featured, { checked: @filters[:featured] == 'true', class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" } %>
              <%= f.label :featured, "Featured Jobs Only", class: "ml-3 block text-sm font-medium text-gray-900" %>
            </div>

            <!-- Sort -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Sort By</label>
              <%= f.select :sort,
                  options_for_select([
                    ['Newest First', 'newest'],
                    ['Oldest First', 'oldest'],
                    ['Highest Salary', 'salary_high'],
                    ['Lowest Salary', 'salary_low'],
                    ['Most Applications', 'applications']
                  ], @filters[:sort]),
                  {},
                  { class: "block w-full border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-gray-50" } %>
            </div>

            <!-- Apply Filters -->
            <div class="pt-4">
              <%= f.submit "Apply Filters",
                  class: "w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-3 rounded-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm font-semibold transform transition-all duration-200 hover:scale-105 shadow-lg" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Enhanced Jobs List -->
      <div class="lg:w-2/3 xl:w-3/4">
        <!-- Results Header -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 mb-6">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div>
              <h2 class="text-2xl font-bold text-gray-900">
                <% if @filters[:search].present? %>
                  Search Results for "<%= @filters[:search] %>"
                <% else %>
                  Discover Amazing Opportunities
                <% end %>
              </h2>
              <p class="text-gray-600 mt-1">
                <% if user_signed_in? %>
                  <%= @pagy.count %> jobs found
                <% else %>
                  <%= @jobs.count %> jobs found
                <% end %>
              </p>
            </div>

            <!-- View Toggle -->
            <div class="flex items-center space-x-2">
              <button class="p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100">
                <%= lucide_icon('grid', class: 'h-5 w-5') %>
              </button>
              <button class="p-2 text-blue-600 bg-blue-50 rounded-lg">
                <%= lucide_icon('list', class: 'h-5 w-5') %>
              </button>
            </div>
          </div>
        </div>

        <!-- Enhanced Jobs Grid -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
          <% @jobs.each do |job| %>
            <div class="group bg-white rounded-2xl shadow-lg border border-gray-100 hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 overflow-hidden">
              <!-- Job Header with Gradient -->
              <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 border-b border-gray-100">
                <div class="flex justify-between items-start mb-4">
                  <div class="flex-1">
                    <h3 class="text-lg font-bold text-gray-900 line-clamp-2 group-hover:text-blue-600 transition-colors">
                      <%= link_to job.title, public_job_path(job), class: "hover:text-blue-600" %>
                    </h3>
                    <div class="flex items-center mt-2">
                      <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-white font-bold text-sm"><%= job.company.name.first.upcase %></span>
                      </div>
                      <div>
                        <p class="font-semibold text-gray-900"><%= job.company.name %></p>
                        <p class="text-sm text-gray-500"><%= job.remote_policy.to_s.titleize %></p>
                      </div>
                    </div>
                  </div>

                  <% if job.featured? %>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-amber-400 to-orange-500 text-white shadow-sm">
                      ⭐ Featured
                    </span>
                  <% end %>
                </div>

                <!-- Quick Tags -->
                <div class="flex flex-wrap gap-2">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    <%= job.display_job_type %>
                  </span>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <%= job.display_experience_level %>
                  </span>
                  <% if job.salary_min.present? || job.salary_max.present? %>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                      <%= job.display_salary %>
                    </span>
                  <% end %>
                </div>
              </div>

              <!-- Job Details -->
              <div class="p-6">
                <div class="space-y-3 mb-4">
                  <div class="flex items-center text-sm text-gray-600">
                    <%= lucide_icon('briefcase', class: 'w-4 h-4 mr-2 text-gray-400') %>
                    <span class="font-medium"><%= job.display_job_type %></span>
                  </div>

                  <div class="flex items-center text-sm text-gray-600">
                    <%= lucide_icon('map-pin', class: 'w-4 h-4 mr-2 text-gray-400') %>
                    <span class="font-medium"><%= job.remote_policy.to_s.titleize %></span>
                  </div>

                  <div class="flex items-center text-sm text-gray-600">
                    <%= lucide_icon('users', class: 'w-4 h-4 mr-2 text-gray-400') %>
                    <span class="font-medium"><%= job.display_experience_level %></span>
                  </div>

                  <% if job.salary_min.present? || job.salary_max.present? %>
                    <div class="flex items-center text-sm text-gray-600">
                      <%= lucide_icon('dollar-sign', class: 'w-4 h-4 mr-2 text-gray-400') %>
                      <span class="font-medium"><%= job.display_salary %></span>
                    </div>
                  <% end %>
                </div>

                <!-- Job Meta -->
                <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                  <div class="flex items-center space-x-4 text-xs text-gray-500">
                    <span class="flex items-center">
                      <%= lucide_icon('clock', class: 'w-3 h-3 mr-1') %>
                      <%= time_ago_in_words(job.published_at) %> ago
                    </span>
                    <span class="flex items-center">
                      <%= lucide_icon('users', class: 'w-3 h-3 mr-1') %>
                      <%= pluralize(job.applications_count, 'application') %>
                    </span>
                  </div>

                  <div class="flex space-x-2">
                    <% if user_signed_in? && current_user.candidate.present? %>
                      <% if job.has_applicant?(current_user.candidate) %>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-800">
                          ✓ Applied
                        </span>
                      <% elsif job.can_be_applied_to? %>
                        <%= link_to "Apply Now", new_job_job_application_path(job),
                            class: "inline-flex items-center px-4 py-2 rounded-lg text-xs font-bold bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700 transform transition-all duration-200 hover:scale-105 shadow-sm" %>
                      <% end %>
                    <% else %>
                      <%= link_to "View Details", public_job_path(job),
                          class: "inline-flex items-center px-4 py-2 rounded-lg text-xs font-bold bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700 transform transition-all duration-200 hover:scale-105 shadow-sm" %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <!-- Enhanced Empty State -->
        <% if @jobs.empty? %>
          <div class="text-center py-16">
            <div class="mx-auto h-24 w-24 text-gray-300 mb-6">
              <%= lucide_icon('search', class: 'h-24 w-24') %>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">No jobs found</h3>
            <p class="text-gray-600 mb-8 max-w-md mx-auto">
              <% if @filters.values.any?(&:present?) %>
                Try adjusting your filters or search terms to find more opportunities.
              <% else %>
                No jobs are currently available. Check back later for new opportunities!
              <% end %>
            </p>
            <%= link_to "Clear Filters", public_jobs_path,
                class: "inline-flex items-center px-6 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold hover:from-blue-700 hover:to-indigo-700 transform transition-all duration-200 hover:scale-105 shadow-lg" %>
          </div>
        <% end %>

        <!-- Enhanced Trial CTA for non-logged-in users -->
        <% if @show_trial_cta %>
          <div class="mt-12 bg-gradient-to-r from-amber-500 via-orange-500 to-red-500 rounded-2xl p-8 text-center relative overflow-hidden">
            <!-- Background Pattern -->
            <div class="absolute inset-0 bg-black/10"></div>
            <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.1"%3E%3Ccircle cx="30" cy="30" r="2"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>

            <div class="relative">
              <h3 class="text-3xl font-bold text-white mb-3">Ready to Find Your Perfect Job?</h3>
              <p class="text-amber-100 mb-6 text-lg max-w-2xl mx-auto">
                Get access to thousands more jobs, advanced filters, personalized recommendations, and direct application tracking.
              </p>
              <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <%= link_to "Start Free Trial", new_user_registration_path,
                    class: "bg-white text-amber-600 px-8 py-4 rounded-xl font-bold hover:bg-amber-50 transform transition-all duration-200 hover:scale-105 shadow-lg" %>
                <%= link_to "Learn More", pricing_path,
                    class: "border-2 border-white text-white px-8 py-4 rounded-xl font-bold hover:bg-white hover:text-amber-600 transform transition-all duration-200 hover:scale-105" %>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Enhanced Pagination -->
        <% if user_signed_in? %>
          <div class="mt-8">
            <%= render "shared/pagination", pagy: @pagy %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
